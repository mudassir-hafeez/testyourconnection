var diff,testObject,appVersion="1.0.0",provider="w-scb-1",ctx=document.getElementById("sc-ctx").getContext("2d"),no=0,pointToFill=4.72,cw=ctx.canvas.width,ch=ctx.canvas.height;function initCircle(){ctx.lineWidth=10,ctx.strokeStyle="#f3f3f3",ctx.beginPath(),ctx.arc(100,100,90,4.72,4.71999),ctx.stroke(),ctx.closePath()}function visualizeProgress(e,t,n){if(ctx.clearRect(0,0,cw,ch),ctx.lineWidth=10,initCircle(),ctx.fillStyle="#2aaee1",ctx.strokeStyle="#2aaee1",ctx.textAlign="center",ctx.font="25px verdana",n&&(ctx.fillStyle="#4c4c4c",ctx.font="lighter 12px Verdana",ctx.fillText(n,100,76)),e&&e.value){ctx.fillStyle="#2aaee1",ctx.font="bolder 28px Verdana","ms"==t?ctx.fillText(e.value,100,110):ctx.fillText(e.value.toFixed(2),100,110);ctx.measureText(e.value).width;ctx.fillStyle="#4c4c4c",ctx.font="bold 12px Verdana",ctx.fillText(t,100,130)}e&&e.progress&&(ctx.strokeStyle="#2aaee1",ctx.beginPath(),diff=e.progress*Math.PI*2*10,ctx.arc(100,100,90,pointToFill,diff/10+pointToFill),ctx.stroke(),ctx.closePath())}function TestObject(){this.pingValue=0,this.downloadValue=0,this.downloadedDataValue=0,this.downloadDuration=0,this.uploadValue=0,this.uploadedDataValue=0,this.uploadDuration=0,this.server=null,this.isp=null,this.browser=null,this.provider=null,this.appVersion=null,this.domain=null}var language,testDuration=2e3,downloadDuration=6e3,uploadDuration=3e3,progressArray=[],bytesList=[],timeList=[],requestArray=[],threads=4,threadCounter=0,isDurationPassed=!1,downloadInterval=null,uploadInterval=null,dataUpload=null,languages={en:{msgPing:"Testing Ping",msgDownload:"Testing Download",msgUpload:"Testing Upload"},de:{msgPing:"Ping testen",msgDownload:"Download testen",msgUpload:"Upload testen"},fr:{msgPing:"Test du ping",msgDownload:"Test du téléchargement",msgUpload:"Test de l'envoi"},it:{msgPing:"Test di ping",msgDownload:"Test di download",msgUpload:"Test di caricamento"},es:{msgPing:"Testeando ping",msgDownload:"Testeando descarga",msgUpload:"Testeando la carga"},pt:{msgPing:"Testando Ping",msgDownload:"Testando Download",msgUpload:"Testando Upload"},nl:{msgPing:"Run Speed Test",msgDownload:"Privacy Policy",msgUpload:"Run Speed Test"},pl:{msgPing:"Run Speed Test",msgDownload:"Privacy Policy",msgUpload:"Run Speed Test"},ru:{msgPing:"Тестирование пинга",msgDownload:"Тестирование скачивания",msgUpload:"Тестирование загрузки"},ko:{msgPing:"Ping 테스트 중",msgDownload:"다운로드 테스트 중",msgUpload:"업로드 테스트 중"},ja:{msgPing:"Pingをテスト中",msgDownload:"ダウンロードをテスト中",msgUpload:"アップロードのテスト中"},nl:{msgPing:"Test ping",msgDownload:"Test download",msgUpload:"Test upload"}};function detectLanguage(){var e=(navigator.language||navigator.userLanguage).slice(0,2);null!=(language=languages[e])&&"undefined"!=language||(language=languages.en)}detectLanguage();var speedcheck={server:null,isp:null,start:function(){var n=this;testObject=new TestObject,loadSettings(function(e,t){n.server=t.server,delete t.server,n.isp=t,testObject.server=n.server,testObject.isp=n.isp,toggleStartButton(),toggleCtx(function(){n.ping()})})},restart:function(){var e=this;(testObject=new TestObject).server=e.server,testObject.isp=e.isp,progressArray=[],bytesList=[],timeList=[],requestArray=[],threadCounter=0,isDurationPassed=!(threads=4),dataUpload=null,toggleResults(function(){toggleCtx(function(){e.ping()})})},ping:function(){var t=this.server.downloadUrl+"ping.txt",n=(new Date,language.msgPing),s="ms";visualizeProgress(null,s,n);var a=this,o=[];pingThreat(0,t,function(e){o.push(e),visualizeProgress({value:calculatePing(o),progress:.25},s,n),pingThreat(0,t,function(e){o.push(e),visualizeProgress({value:calculatePing(o),progress:.5},s,n),pingThreat(0,t,function(e){o.push(e),visualizeProgress({value:calculatePing(o),progress:.75},s,n),pingThreat(0,t,function(e){o.push(e);var t=calculatePing(o);visualizeProgress({value:testObject.pingValue=t,progress:1},s,n),setTimeout(function(){a.download()},100)})})})})},download:function(){var e=this.server,t=e.downloadUrl+e.downloadSize,n=new Date,s=language.msgDownload,a="Mbps";visualizeProgress(null,a,s);for(var o=0;o<threads;++o)downloadThreat(threadCounter=o,t,n);downloadInterval=setInterval(function(){var e=calculateSpeed(n,a,s,downloadDuration);testObject.downloadValue=e},100),setTimeout(function(){cancelAll(),testObject.downloadedDataValue=bytesList[bytesList.length-1],progressArray=[],bytesList=[],timeList=[],window.setTimeout(function(){speedcheck.upload()},100)},downloadDuration)},upload:function(){var e=this.server.uploadUrl,t=new Date,n=language.msgUpload,s="Mbps";visualizeProgress(null,s,n);for(var a=new ArrayBuffer(1048576),o=[],r=0;r<20;r++)o.push(a);dataUpload=new Blob(o);for(r=0;r<threads;++r)uploadThreat(threadCounter=r,e,t);uploadInterval=setInterval(function(){var e=calculateSpeed(t,s,n,uploadDuration);testObject.uploadValue=e},100),setTimeout(function(){testObject.uploadedDataValue=bytesList[bytesList.length-1],cancelAll(),setTimeout(function(){toggleCtx(function(){presentResult(),toggleResults(function(){finalizeTest(testObject),saveTest(testObject)})})},500)},uploadDuration)}};function finalizeTest(e){e.appVersion=appVersion,e.downloadDuration=downloadDuration,e.uploadDuration=uploadDuration,e.browser=getBrowser(),e.provider=provider,e.domain=extractRootDomain(window.location.host)}function loadSettings(t){var n=new XMLHttpRequest;n.open("GET","https://api.speedspot.org/basic",!0),n.onload=function(){if(200<=n.status&&n.status<400){var e=JSON.parse(n.responseText);t(null,e)}else t("error")},n.onerror=function(){t("error")},n.send()}function saveTest(e){var t=new XMLHttpRequest;t.open("POST","https://api.speedspot.org/basic",!0),t.setRequestHeader("Content-Type","application/json"),t.send(JSON.stringify(e)),t.onload=function(){JSON.parse(this.responseText)}}function pingThreat(e,t,n){var s=new XMLHttpRequest;s.onreadystatechange=function(){if(2===s.readyState){var e=(new Date).getTime();n(e-o)}};var a=t+"?"+Math.random();s.open("GET",a,!0),s.send();var o=(new Date).getTime()}function downloadThreat(e,t,n){var s=new XMLHttpRequest;s.responseType="blob",s.onprogress=progressHandler(e),s.onload=function(e){threadCounter++,isDurationPassed||downloadThreat(threadCounter,n)},s.open("GET",t+"?"+Math.random(),!0),s.send(),requestArray.push(s)}function uploadThreat(e,t,n){var s=new XMLHttpRequest;s.responseType="blob",s.upload.onprogress=progressHandler(e),s.upload.onload=function(){threadCounter++,!isDurationPassed&&threadCounter<8&&uploadThreat(observer,threadCounter)},s.open("POST",t+"?"+Math.random(),!0),s.send(dataUpload),requestArray.push(s)}function progressHandler(n){return function(e){null!=progressArray[n]&&null!=progressArray[n]||(progressArray[n]={bytes:0});var t=e.loaded;progressArray[n].bytes=t}}function calculatePing(e){for(var t=0,n=0;n<e.length;n++){t+=e[n]}return Math.round(t/e.length)}function calculateSpeed(e,t,n,s){for(var a=0,o=progressArray.length-1;0<=o;o--){var r=progressArray[o];null!=r&&null!=r.bytes&&(a+=r.bytes)}bytesList.push(a),timeList.push((new Date).getTime());var i=calculateCurrentSpeedMbps(bytesList,timeList,100);return visualizeProgress({value:i,progress:((new Date).getTime()-e.getTime())/s},t,n),i}function calculateCurrentSpeedMbps(e,t,n){if(1<e.length&&1<t.length){for(var s=t[0],a=Math.min(e.length,t.length)-1,o=(t[a]-s)/n,r=[],i=e[0],l=1,u=0;u<n;++u){for(var d=t[l],c=u*o+s;d<c&&l<a;)d=t[l+=1];if(l<a){var g=(d-c)/(d-t[l-1]),p=e[l]-(e[l]-e[l-1])*g,v=(p-i)/o;r.push(v),i=p}else r.push(0)}var f=30*(r=r.sort()).length/100-1,h=90*r.length/100-1;f+1<h&&(r=r.slice(f,h+1));var m=0;for(u=0;u<r.length;++u)m+=r[u];return parseFloat((m/r.length*8/1e3).toFixed(2))}}function cancelAll(){clearInterval(downloadInterval),clearInterval(uploadInterval),isDurationPassed=!0;for(var e=0;e<requestArray.length;++e){requestArray[e].abort(),isDurationPassed=!1}requestArray=[]}function toggleStartButton(){var e=document.getElementById("sc-start-button"),t=document.getElementById("sc-footer");"none"===e.style.display?(e.style.display="block",t.style.display="block"):(e.style.display="none",t.style.display="none")}function toggleDetailsButton(){var e=document.getElementById("sc-details-button");"none"===e.style.display?e.style.display="block":e.style.display="none"}function toggleCtx(e){var t=document.getElementById("sc-ctx");if(t.classList.contains("sc-is-visible"))return t.classList.remove("sc-is-shown"),void setTimeout(function(){t.classList.remove("sc-is-visible"),e()},320);t.classList.add("sc-is-visible"),setTimeout(function(){t.classList.add("sc-is-shown"),e()},20)}function toggleResults(e){var t=document.getElementById("sc-results"),n=document.getElementById("sc-results-actions");if(t.classList.contains("sc-is-visible"))return t.classList.remove("sc-is-shown"),n.classList.remove("sc-is-shown"),void setTimeout(function(){t.classList.remove("sc-is-visible"),n.classList.remove("sc-is-visible"),e()},320);t.classList.add("sc-is-visible"),n.classList.add("sc-is-visible"),setTimeout(function(){t.classList.add("sc-is-shown"),n.classList.add("sc-is-shown"),e()},20)}function presentResult(){var e=document.getElementById("sc-results-ping"),t=document.getElementById("sc-results-download"),n=document.getElementById("sc-results-upload");e.innerHTML='<span style="font-size:20px">&bull; </span><span class="sc-value">'+testObject.pingValue+'</span>&nbsp;<span class="sc-unit">ms</span>',t.innerHTML='<span style="font-size:20px">&darr; </span><span class="sc-value">'+Math.round(testObject.downloadValue)+'</span>&nbsp;<span class="sc-unit">Mbps</span>',n.innerHTML='<span style="font-size:20px">&uarr; </span><span class="sc-value">'+Math.round(testObject.uploadValue)+'</span>&nbsp;<span class="sc-unit">Mbps</span>'}function isMobile(){return/Mobi/.test(navigator.userAgent)}function getBrowserName(){return window.opr&&window.opr.addons||window.opera||0<=navigator.userAgent.indexOf(" OPR/")?"Opera":"undefined"!=typeof InstallTrigger?"Firefox":/constructor/i.test(window.HTMLElement)||"[object SafariRemoteNotification]"===(!window.safari).toString()?"Safari":document.documentMode?"Internet Explorer":!document.documentMode&&window.StyleMedia?"Microsoft Edge":window.chrome?"Chrome":void 0}function getOSName(){var e;if(isMobile())if(/Windows/.test(navigator.userAgent))e="Windows",/Phone 8.0/.test(navigator.userAgent)?e+=" Phone 8.0":/Phone 10.0/.test(navigator.userAgent)&&(e+=" Phone 10.0");else if(/Android/.test(navigator.userAgent)){e=(n=function(){if(/Android/.test(navigator.appVersion))return navigator.appVersion.match(/Android (\d+).(\d+)/)}())[0]}else if(/iPhone;/.test(navigator.userAgent)){function t(){if(/iP(hone|od|ad)/.test(navigator.appVersion)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}}e="iOS "+(n=t())[0]+"."+n[1]+"."+n[2]}else if(/iPad;/.test(navigator.userAgent)){function t(){if(/iP(hone|od|ad)/.test(navigator.appVersion)){var e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}}var n;e="iOS "+(n=t())[0]+"."+n[1]+"."+n[2]}else/BBd*/.test(navigator.userAgent)&&(e="BlackBerry");else/Windows/.test(navigator.userAgent)?(e="Windows",/5.1;/.test(navigator.userAgent)?e+=" XP":/6.0;/.test(navigator.userAgent)?e+=" Vista":/6.1;/.test(navigator.userAgent)?e+=" 7":/6.2/.test(navigator.userAgent)?e+=" 8":/10.0;/.test(navigator.userAgent)&&(e+=" 10"),/64/.test(navigator.userAgent)?e+=" 64-bit":e+=" 32-bit"):/Macintosh/.test(navigator.userAgent)&&(e="Macintosh",/OS X/.test(navigator.userAgent)&&(e+=" OS X"));return e}function getBrowser(){return{os:getOSName(),browser:getBrowserName(),language:navigator.language,languages:navigator.languages,user_agent:navigator.userAgent,device:isMobile()?"Mobile":"Desktop",referrer:document.referrer||"N/A",online:navigator.onLine,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,screen_resolution:screen.width+" x "+screen.height,cookie_enabled:navigator.cookieEnabled}}function extractRootDomain(e){var t=e.split("."),n=t.length;return 2<n&&(e=t[n-2]+"."+t[n-1],2==t[n-2].length&&2==t[n-1].length&&(e=t[n-3]+"."+e)),e}!function(){var e=document.getElementById("sc-test-container");"none"===e.style.display?e.style.display="block":e.style.display="none"}();